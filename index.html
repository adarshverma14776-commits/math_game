<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Make Your Maths Easy with Programming</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --bg:#0f172a; --card:#0b1220; --text:#e6eef8; --muted:#9fb3d0; --accent:#60a5fa;
    }
    [data-theme="light"]{--bg:#f7fafc; --card:#ffffff; --text:#0b1220; --muted:#4b5563; --accent:#2563eb}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,var(--bg),#071025);color:var(--text);min-height:100vh}
    .app{max-width:1100px;margin:32px auto;padding:20px}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px}
    header h1{margin:0;font-size:1.4rem}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    .row{display:flex;gap:12px}
    .col{flex:1}
    #welcome{display:grid;grid-template-columns:1fr 380px;gap:18px;align-items:start}
    .controls label{display:block;margin-top:10px;font-size:0.9rem;color:var(--muted)}
    .controls input,.controls select,.controls button{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text)}
    .controls button{cursor:pointer;background:linear-gradient(90deg,var(--accent),#7dd3fc);color:#012!important;border:none}
    nav{display:flex;gap:8px;flex-wrap:wrap}
    nav button{background:transparent;border:1px solid rgba(255,255,255,0.05);padding:8px 12px;border-radius:10px;color:var(--text);cursor:pointer}
    .topic-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .topic-item{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)}
    .small{font-size:0.85rem;color:var(--muted);}
    #workarea{margin-top:18px;display:grid;grid-template-columns:1fr 360px;gap:18px}
    .scroll{overflow:auto;max-height:70vh;padding-right:8px}
    .grid{display:grid;grid-template-columns:repeat(9,44px);grid-gap:4px;}
    .cell{width:44px;height:44px;display:flex;align-items:center;justify-content:center;background:#212e45;border-radius:8px;font-weight:600;font-size:1.2rem;color:#e6eef8;border:1px solid var(--muted);}
    .msq-table{border-collapse:collapse;margin-top:12px;}
    .msq-table td{border:1px solid #60a5fa;padding:10px 18px;background:#17213a;border-radius:6px;font-size:1.1rem;color:#e6eef8;text-align:center}
    footer{margin-top:18px;display:flex;justify-content:space-between;align-items:center}
    @media (max-width:900px){#welcome{grid-template-columns:1fr}#workarea{grid-template-columns:1fr}}
  </style>
</head>
<body data-theme="dark">
  <div class="app">
    <header class="row">
      <div>
        <h1>Make Your Maths Easy with Programming</h1>
        <p class="small">RSBVP 2025 — Mathematical Modeling through Computer Programs</p>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <label class="small">Theme</label>
        <button id="themeToggle" class="card">Toggle Dark/Light</button>
      </div>
    </header>
    <main id="page" class="card">
      <section id="page1">
        <div id="welcome">
          <div class="col card">
            <h2>Welcome — tell us your name</h2>
            <div class="controls">
              <label>Name</label>
              <input id="userName" placeholder="Your name" />
              <label>Choose a topic</label>
              <select id="topicSelect">
                <option value="magic">Magic Squares</option>
                <option value="sudoku">Sudoku</option>
              </select>
              <label>Animations</label>
              <div style="display:flex;gap:8px">
                <button id="animOn">On</button>
                <button id="animOff">Off</button>
              </div>
              <label style="margin-top:12px">Browser-ready</label>
              <small class="small">Works on modern Chrome, Edge, Firefox, Safari.</small>
              <div style="margin-top:12px">
                <button id="enterApp">Enter</button>
              </div>
            </div>
          </div>
          <div class="col card">
            <h3>Quick Tour</h3>
            <p class="small">Enter your name and topic.<br />
              - Get definitions and history<br>
              - Generate randomized examples<br>
              - Visual interactive puzzles<br>
              - Downloadable PDF reports<br>
            </p>
            <hr />
            <h4>Tips</h4>
            <ul class="small">
              <li>Pick a topic and number of examples</li>
              <li>Use "Download PDF" to export the puzzles</li>
              <li>Toggle theme for easier viewing or printing</li>
            </ul>
          </div>
        </div>
      </section>
      <section id="page2" style="display:none">
        <div class="row">
          <div class="col card">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <h2 id="greeting"></h2>
                <div class="small" id="topicSubtitle"></div>
              </div>
              <div style="display:flex;gap:8px;align-items:center">
                <button id="backBtn">Back</button>
                <button id="downloadPdf">Download PDF</button>
              </div>
            </div>
            <hr />
            <div id="definition" class="scroll"></div>
            <div style="margin-top:12px">
              <label class="small">How many examples would you like? (Enter a number)</label>
              <input id="exampleCount" type="number" min="1" value="3" style="width:100px" />
              <div style="margin-top:8px">
                <button id="genExamples">Generate Examples</button>
                <button id="solveExamples">Show Solutions</button>
              </div>
            </div>
            <div id="examplesArea" style="margin-top:12px"></div>
          </div>
          <aside class="card" style="min-width:320px">
            <h3>Tools</h3>
            <div class="small">Calculator</div>
            <input id="calcInput" placeholder="Enter expression, e.g. 3*(4+2)" />
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="calcEval">Evaluate</button>
              <button id="clearCalc">Clear</button>
            </div>
            <div id="calcOut" class="small" style="margin-top:8px"></div>
            <hr />
            <h3>Graphs & Visuals</h3>
            <canvas id="chart" width="300" height="200"></canvas>
            <div style="margin-top:8px">
              <button id="showSequenceGraph">Plot Sample Sequence</button>
            </div>
          </aside>
        </div>
      </section>
      <div id="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:40">
        <div id="modalCard" class="card" style="width:760px;max-width:95%;padding:16px;">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 id="modalTitle"></h3>
            <button id="closeModal">Close</button>
          </div>
          <div id="modalBody" style="margin-top:8px"></div>
        </div>
      </div>
    </main>
    <footer class="small card">
      <div>Made for RSBVP 2025 • Interactive Maths App</div>
      <div>Features: animations, dark/light, visual puzzles, PDF export, charts</div>
    </footer>
  </div>
  <script>
    // --- State ---
    const state = {anim:true, examplesHistory:{}};
    const topics = {
      magic:{title:'Magic Squares', key:'magic', def:'A magic square is a square grid where numbers are arranged so each row, column and diagonal add up to the same constant. Used in ancient mathematics around the world.', examples:[
        {q:'Create a 3×3 magic square using 1..9', solve:()=>generateOddMagic(3)}
      ]},
      sudoku:{title:'Sudoku', key:'sudoku', def:'Sudoku is a logic-based puzzle where each row, column and 3×3 box contains numbers 1–9 exactly once.', examples:[
        {q:'Solve this example Sudoku', solve:()=>demoSudoku()}
      ]}
    };
    // Utility for unique random pick
    function pickUnique(arr,count){
      const copy = arr.slice();
      const out = [];
      count = Math.max(1,Math.min(count,arr.length));
      while(out.length < count){
        const i = Math.floor(Math.random()*copy.length);
        out.push(copy.splice(i,1)[0]);
      }
      return out;
    }

    document.getElementById('themeToggle').onclick = ()=>{
      const el = document.body;
      el.setAttribute('data-theme', el.getAttribute('data-theme')==='light' ? 'dark' : 'light');
    };
    document.getElementById('animOff').onclick = ()=>state.anim=false;
    document.getElementById('animOn').onclick = ()=>state.anim=true;

    document.getElementById('enterApp').onclick = ()=>{
      const name = document.getElementById('userName').value.trim() || 'Student';
      const topic = document.getElementById('topicSelect').value;
      enterWorkspace(name,topic);
    };

    document.getElementById('backBtn').onclick = ()=>{
      document.getElementById('page1').style.display='block';
      document.getElementById('page2').style.display='none';
    };

    document.getElementById('genExamples').onclick = async ()=>{
      const count = parseInt(document.getElementById('exampleCount').value)||1;
      await generateExamples(count);
    };
    document.getElementById('solveExamples').onclick = ()=>{showSolutions();};

    document.getElementById('downloadPdf').onclick = ()=>downloadPDF();

    document.getElementById('calcEval').onclick = ()=>{
      const expr = document.getElementById('calcInput').value;
      try{ const val = eval(expr); document.getElementById('calcOut').innerText = 'Result: '+String(val); }catch(e){document.getElementById('calcOut').innerText='Error';}
    };
    document.getElementById('clearCalc').onclick = ()=>{
      document.getElementById('calcInput').value='';
      document.getElementById('calcOut').innerText='';
    };

    document.getElementById('showSequenceGraph').onclick = ()=>{
      plotSequence();
    };

    // Enter workspace and display topic info
    function enterWorkspace(name,topicKey){
      const t = topics[topicKey];
      document.getElementById('page1').style.display='none';
      document.getElementById('page2').style.display='block';
      document.getElementById('greeting').innerText = `Hello, ${name}!`;
      document.getElementById('topicSubtitle').innerText = t.title;
      document.getElementById('definition').innerHTML = `<h3>Definition & History</h3><p>${t.def}</p><p class='small'>Topic: ${t.title}</p>`;
      state.currentTopic = topicKey;
      state.userName = name;
      document.getElementById('examplesArea').innerHTML = '';
    }

    // Generate visual examples
    async function generateExamples(count){
      const t = topics[state.currentTopic];
      if(!t) return alert('Pick a topic first');
      const chosen = pickUnique(t.examples,count);
      const area = document.getElementById('examplesArea');
      area.innerHTML='';
      state.latestExamples = [];
      for(let i=0;i<chosen.length;i++){
        const ex = chosen[i];
        state.latestExamples.push({q:ex.q,solve:ex.solve});
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML = `<strong>${ex.q}</strong><div id="vis${i}" style="margin-top:12px"></div><button data-id='${i}' class='showSolve'>Show solution</button><div id='sol${i}' style='margin-top:8px'></div>`;
        area.appendChild(card);

        // If it's a visual (Sudoku or Magic), auto-display grid
        if(state.currentTopic==='sudoku'){
          drawSudokuGrid('vis'+i, demoSudoku());
        } else if(state.currentTopic==='magic'){
          drawMagicSquare('vis'+i, generateOddMagic(3).matrix);
        }
      }
      document.querySelectorAll('.showSolve').forEach(btn=>btn.onclick = async ()=>{
        const i = parseInt(btn.getAttribute('data-id'));
        const solBox = document.getElementById('sol'+i);
        solBox.innerHTML = '<em>Computing...</em>';
        try{
          // For demo, just re-show grid; you can expand to step-by-step solution
          if(state.currentTopic==='sudoku'){
            drawSudokuGrid('sol'+i, demoSudoku());
            solBox.innerHTML = '';
          } else if(state.currentTopic==='magic'){
            drawMagicSquare('sol'+i, generateOddMagic(3).matrix);
            solBox.innerHTML = '';
          }
        }catch(e){solBox.innerText = 'Could not get solution.'}
      });
    }

    function showSolutions(){
      if(!state.latestExamples) return;
      state.latestExamples.forEach((ex,i)=>{
        const btn = document.querySelector(`button[data-id='${i}']`);
        if(btn) btn.click();
      });
    }

    // MAGIC SQUARE: Siamese method for odd-order
    function generateOddMagic(n){
      if(n%2===0) return 'Siamese method only for odd n';
      const a = Array.from({length:n},()=>Array(n).fill(0));
      let num=1;let i=0,j=Math.floor(n/2);
      while(num<=n*n){a[i][j]=num;num++;let ni=(i-1+n)%n;let nj=(j+1)%n;if(a[ni][nj]){i=(i+1)%n;}else{i=ni;j=nj;}}
      return {matrix:a,magicConstant:n*(n*n+1)/2,isMagic:true};
    }
    // SUDOKU: static sample board
    function demoSudoku(){
      return [
        [5,3,4,6,7,8,9,1,2],
        [6,7,2,1,9,5,3,4,8],
        [1,9,8,3,4,2,5,6,7],
        [8,5,9,7,6,1,4,2,3],
        [4,2,6,8,5,3,7,9,1],
        [7,1,3,9,2,4,8,5,6],
        [9,6,1,5,3,7,2,8,4],
        [2,8,7,4,1,9,6,3,5],
        [3,4,5,2,8,6,1,7,9]
      ];
    }
    // Draw Sudoku grid
    function drawSudokuGrid(id,gridArr){
      const el = document.getElementById(id);
      el.innerHTML = '';
      const grid = document.createElement('div');
      grid.className = 'grid';
      for(let i=0;i<9;i++){
        for(let j=0;j<9;j++){
          const cell = document.createElement('div');
          cell.className='cell';
          cell.innerText = gridArr[i][j];
          grid.appendChild(cell);
        }
      }
      el.appendChild(grid);
    }
    // Draw Magic Square
    function drawMagicSquare(id,matrix){
      const el = document.getElementById(id);
      el.innerHTML = '';
      const table = document.createElement('table');
      table.className = 'msq-table';
      for(let i=0;i<matrix.length;i++){
        const tr = document.createElement('tr');
        for(let j=0;j<matrix[i].length;j++){
          const td = document.createElement('td');
          td.innerText = matrix[i][j];
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
      el.appendChild(table);
    }
    // Chart.js sample sequence
    function plotSequence(){
      const ctx = document.getElementById('chart').getContext('2d');
      const sequence = [0,1,1,2,3,5,8,13,21,34,55,89];
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: sequence.map((_,i)=>i+1),
          datasets: [{label: "Fibonacci", data:sequence, borderColor: "#60a5fa"}]
        },
        options: {responsive:false}
      });
    }
    // PDF export
    function downloadPDF(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("Make Your Maths Easy with Programming", 10, 10);
      doc.text(`User: ${state.userName || ''}`, 10, 20);
      doc.text(`Topic: ${topics[state.currentTopic]?.title || ''}`, 10, 30);
      const area = document.getElementById('examplesArea');
      doc.text("Puzzles:\n" + area.innerText, 10, 40);
      doc.save("math_examples.pdf");
    }
  </script>
</body>
</html>
